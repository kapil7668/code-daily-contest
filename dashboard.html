<!DOCTYPE html>
<html lang="hi">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>CodeRush Dashboard ‚Äì Practice & Contests</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <style>
    * { font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif; }
  </style>
</head>

<body class="min-h-screen text-slate-100 bg-slate-950 bg-[radial-gradient(circle_at_top,_rgba(45,212,191,0.23),_transparent_52%),radial-gradient(circle_at_bottom,_rgba(37,99,235,0.22),_transparent_55%)]">

<!-- Top Navbar -->
<header class="border-b border-slate-800/60 bg-slate-950/80 backdrop-blur sticky top-0 z-30">
  <nav class="max-w-6xl mx-auto flex items-center justify-between px-4 py-3">
    <div class="flex items-center gap-2">
      <div class="h-8 w-8 rounded-xl bg-gradient-to-br from-emerald-400 to-cyan-500 flex items-center justify-center text-slate-900 font-extrabold">
        C
      </div>
      <span class="font-semibold text-lg tracking-tight">CodeRush</span>
    </div>

    <div class="hidden md:flex items-center gap-5 text-sm">
      <button data-tab="explore" class="tab-btn text-emerald-400 border-b border-emerald-400 pb-1">Explore</button>
      <button data-tab="problems" class="tab-btn text-slate-300 hover:text-emerald-300">Problems</button>
      <button data-tab="contests" class="tab-btn text-slate-300 hover:text-emerald-300">Contests</button>
      <button data-tab="premium" class="tab-btn text-slate-300 hover:text-emerald-300">Premium</button>
    </div>

    <div class="flex items-center gap-3 text-xs">
      <span id="user-email" class="hidden sm:inline text-slate-300"></span>
      <button id="logout-btn" class="px-3 py-1.5 rounded-lg border border-slate-700 hover:border-red-400 hover:text-red-300">
        Logout
      </button>
    </div>
  </nav>
</header>

<main class="max-w-6xl mx-auto px-4 py-5 md:py-7 text-sm bg-slate-900/75 border border-slate-800/60 rounded-2xl shadow-[0_0_40px_rgba(15,23,42,0.95)] mt-6 mb-10">

  <!-- Explore Tab -->
  <section id="tab-explore" class="tab-page">
    <h1 class="text-xl md:text-2xl font-bold mb-1">Welcome to CodeRush</h1>
    <p class="text-slate-300 mb-4 text-xs md:text-sm">
      Pick a target, join a contest, and level up your DSA skills every single day on CodeRush.
    </p>

    <!-- Top 3 cards -->
    <div class="grid md:grid-cols-3 gap-4 mb-2 md:mb-4">
      <div class="bg-slate-800/70 border border-slate-700 rounded-xl p-4">
        <h2 class="font-semibold mb-1 text-sm">Today's target</h2>
        <p class="text-slate-300 text-xs mb-2">Solve 3 problems: 1 Easy, 1 Medium, 1 Hard.</p>
        <ul class="text-[11px] text-slate-400 space-y-1">
          <li>‚Ä¢ Arrays & Hashing</li>
          <li>‚Ä¢ Two Pointers</li>
          <li>‚Ä¢ Binary Search</li>
        </ul>
      </div>

      <div class="bg-slate-800/70 border border-slate-700 rounded-xl p-4">
        <h2 class="font-semibold mb-1 text-sm">Practice sets</h2>
        <p class="text-slate-300 text-xs mb-2">Hand-picked sets for interviews and contests.</p>
        <ul class="text-[11px] text-slate-400 space-y-1">
          <li>‚Ä¢ Beginner 50 DSA</li>
          <li>‚Ä¢ 75 Must-Do Questions</li>
          <li>‚Ä¢ Company-wise sheets</li>
        </ul>
      </div>

      <!-- Quick stats card -->
      <div class="bg-slate-800/70 border border-slate-700 rounded-xl p-4">
        <h2 class="font-semibold mb-1 text-sm">Quick stats</h2>
        <p class="text-slate-300 text-xs mb-2">Live contest stats from your account.</p>
        <ul class="text-[11px] text-slate-400 space-y-1">
          <li>Total contests: <span id="stat-total-contests">0</span></li>
          <li>Best score: <span id="stat-best-score">0</span></li>
          <li>Best rank: <span id="stat-best-rank">-</span></li>
        </ul>
      </div>
    </div>

    <!-- Active contests -->
    <section class="mt-4 md:mt-6">
      <div class="flex items-center justify-between mb-3">
        <h2 class="text-base md:text-lg font-semibold">Active contests</h2>
        <button class="text-[11px] text-emerald-400 hover:text-emerald-300" onclick="document.querySelector('[data-tab=contests]').click()">
          View all contests
        </button>
      </div>

      <div class="grid md:grid-cols-3 gap-4 text-xs">
        <!-- PAID-9 (Working!) -->
        <div class="bg-slate-800/80 border border-amber-500/40 rounded-xl p-4 flex flex-col justify-between">
          <div>
            <p class="text-[11px] uppercase tracking-wide text-amber-400 mb-1">LIVE NOW</p>
            <h3 class="font-semibold text-sm mb-1">PAID-9 Contest</h3>
            <p class="text-slate-300 text-[11px] mb-2">5 MCQs ‚Ä¢ 60 mins ‚Ä¢ ‚Çπ900 Prize Pool</p>
            <p class="text-slate-400 text-[11px]">Join anytime ‚Ä¢ Live leaderboard</p>
          </div>
          <a href="exam.html?contestId=paid-9" class="mt-3 self-start px-4 py-2 rounded-lg bg-gradient-to-r from-amber-500 to-orange-500 text-slate-900 text-[11px] font-bold inline-block hover:from-amber-600 hover:to-orange-600">
            üöÄ START EXAM
          </a>
        </div>

        <!-- Free Daily -->
        <div class="bg-slate-800/80 border border-emerald-500/40 rounded-xl p-4 flex flex-col justify-between">
          <div>
            <p class="text-[11px] uppercase tracking-wide text-emerald-400 mb-1">Coming Soon</p>
            <h3 class="font-semibold text-sm mb-1">Free Daily Rush</h3>
            <p class="text-slate-300 text-[11px] mb-2">3 problems ‚Ä¢ 60 mins ‚Ä¢ Free entry</p>
          </div>
          <button class="mt-3 self-start px-3 py-1.5 rounded-lg border border-emerald-400 text-emerald-300 text-[11px] font-semibold">
            Soon
          </button>
        </div>

        <!-- Community Contest -->
        <div class="bg-slate-800/70 border border-slate-700 rounded-xl p-4 flex flex-col justify-between">
          <div>
            <p class="text-[11px] uppercase tracking-wide text-cyan-400 mb-1">Community</p>
            <h3 class="font-semibold text-sm mb-1">College Contest</h3>
            <p class="text-slate-300 text-[11px] mb-2">Host for your college/community</p>
          </div>
          <button class="mt-3 self-start px-3 py-1.5 rounded-lg border border-slate-600 text-slate-200 text-[11px] font-semibold">
            Request slot
          </button>
        </div>
      </div>
    </section>

    <!-- Leaderboards -->
    <section id="global-leaderboard" class="mt-6 bg-slate-900/80 border border-slate-800 rounded-2xl p-4">
      <h2 class="text-sm font-semibold text-slate-100 mb-3">üèÜ Top 10 Leaderboard</h2>
      <div id="global-leaderboard-body" class="text-xs text-slate-200">
        <p class="text-[11px] text-slate-400">Loading live scores...</p>
      </div>
    </section>
  </section>

  <!-- Problems Tab -->
  <section id="tab-problems" class="tab-page hidden">
    <h2 class="text-lg font-semibold mb-4">Practice Problems</h2>
    <div class="grid md:grid-cols-3 gap-4">
      <div class="bg-slate-800/80 border border-slate-700 rounded-xl p-6 text-center">
        <h3 class="font-bold text-lg mb-2">Beginner DSA</h3>
        <p class="text-slate-400 mb-4">20 essential problems</p>
        <button class="px-6 py-2 rounded-lg border border-emerald-400 text-emerald-300 font-semibold">Start</button>
      </div>
      <div class="bg-slate-800/80 border border-slate-700 rounded-xl p-6 text-center">
        <h3 class="font-bold text-lg mb-2">Core DSA</h3>
        <p class="text-slate-400 mb-4">50 interview problems</p>
        <button class="px-6 py-2 rounded-lg border border-slate-600 text-slate-200 font-semibold">Coming Soon</button>
      </div>
      <div class="bg-slate-800/80 border border-slate-700 rounded-xl p-6 text-center">
        <h3 class="font-bold text-lg mb-2">Company Sheets</h3>
        <p class="text-slate-400 mb-4">FAANG style questions</p>
        <button class="px-6 py-2 rounded-lg border border-slate-600 text-slate-200 font-semibold">Coming Soon</button>
      </div>
    </div>
  </section>

  <!-- Contests Tab -->
  <section id="tab-contests" class="tab-page hidden">
    <h2 class="text-2xl font-bold mb-6">Live Contests</h2>
    <div class="grid md:grid-cols-2 lg:grid-cols-3 gap-6">
      <a href="exam.html?contestId=paid-9" class="group bg-gradient-to-br from-amber-500 to-orange-500 rounded-3xl p-8 text-amber-950 hover:scale-105 transition-all duration-300 shadow-2xl">
        <div class="text-4xl font-black mb-2">‚Çπ900</div>
        <h3 class="text-xl font-bold mb-2">PAID-9 Contest</h3>
        <p class="text-amber-900 mb-4">Entry ‚Çπ9 ‚Ä¢ 5 MCQs ‚Ä¢ Live Now</p>
        <span class="bg-white/20 px-4 py-2 rounded-xl font-bold text-sm">START EXAM ‚Üí</span>
      </a>
    </div>
  </section>

  <!-- Premium Tab -->
  <section id="tab-premium" class="tab-page hidden">
    <h2 class="text-2xl font-bold mb-6">Premium Features</h2>
    <p class="text-slate-400 mb-8">Coming soon...</p>
  </section>

</main>

<script>
const SUPABASE_URL = 'https://tghtgygjawhrcgtwhrej.supabase.co';
const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InRnaHRneWdqYXdocmNndHdocmVqIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjU5OTM0MjksImV4cCI6MjA4MTU2OTQyOX0.Q-Ht_IFcPZPIHO5905o70EDya2yFdVP-9LjDmjkle38';

const supabaseClient = Supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);
const emailSpan = document.getElementById('user-email');

// Auth check
(async () => {
  const { data, error } = await supabaseClient.auth.getUser();
  if (error || !data.user) {
    window.location.href = 'index.html';
    return;
  }
  emailSpan.textContent = data.user.email || data.user.user_metadata?.full_name || 'User';
})();

// Logout
document.getElementById('logout-btn').onclick = async () => {
  await supabaseClient.auth.signOut();
  window.location.href = 'index.html';
};

// Tabs
const tabButtons = document.querySelectorAll('.tab-btn');
const tabPages = {
  explore: document.getElementById('tab-explore'),
  problems: document.getElementById('tab-problems'),
  contests: document.getElementById('tab-contests'),
  premium: document.getElementById('tab-premium')
};

tabButtons.forEach(btn => {
  btn.onclick = () => {
    const tab = btn.dataset.tab;
    tabButtons.forEach(b => {
      b.classList.remove('text-emerald-400', 'border-b', 'border-emerald-400');
      b.classList.add('text-slate-300');
    });
    btn.classList.add('text-emerald-400', 'border-b', 'border-emerald-400');
    
    Object.values(tabPages).forEach(page => page.classList.add('hidden'));
    tabPages[tab].classList.remove('hidden');
  };
});

// Load leaderboards
async function loadLeaderboards() {
  try {
    const { data: { user } } = await supabaseClient.auth.getUser();
    
    // Global leaderboard
    const { data: scores } = await supabaseClient
      .from('leaderboard')
      .select('user_id, score, contest_id, completed_at')
      .order('score', { ascending: false })
      .limit(10);
    
    const leaderboardBody = document.getElementById('global-leaderboard-body');
    if (scores && scores.length > 0) {
      leaderboardBody.innerHTML = scores.map((row, i) => {
        const isYou = user?.id === row.user_id;
        return `
          <div class="flex items-center p-3 bg-slate-800/50 rounded-xl mb-2 ${isYou ? 'border-l-4 border-emerald-400' : ''}">
            <span class="w-8 font-bold text-lg ${isYou ? 'text-emerald-400' : 'text-slate-200'}">${i+1}</span>
            <span class="ml-3 font-semibold ${isYou ? 'text-emerald-400' : 'text-slate-100'}">${row.user_id?.slice(0,6)}...</span>
            <span class="ml-auto font-bold text-emerald-400">${row.score}</span>
            <span class="ml-2 text-xs text-slate-400">${row.contest_id}</span>
          </div>
        `;
      }).join('');
    } else {
      leaderboardBody.innerHTML = '<p class="text-slate-400 text-sm">No scores yet. Be the first! üéâ</p>';
    }
  } catch(e) {
    console.error('Leaderboard error:', e);
    document.getElementById('global-leaderboard-body').innerHTML = '<p class="text-red-400 text-sm">Loading...</p>';
  }
}

// Stats
async function loadStats() {
  try {
    const { data: { user } } = await supabaseClient.auth.getUser();
    const { data: scores } = await supabaseClient
      .from('leaderboard')
      .select('score')
      .eq('user_id', user?.id);
    
    document.getElementById('stat-total-contests').textContent = scores?.length || 0;
    document.getElementById('stat-best-score').textContent = scores?.reduce((max, s) => Math.max(max, s.score), 0) || 0;
    document.getElementById('stat-best-rank').textContent = '-';
  } catch(e) {
    console.error('Stats error:', e);
  }
}

document.addEventListener('DOMContentLoaded', () => {
  loadLeaderboards();
  loadStats();
});
</script>

</body>
</html>
