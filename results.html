<!DOCTYPE html>
<html lang="hi">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Results - CodeRush</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>* { font-family: system-ui, sans-serif; }</style>
</head>
<body class="min-h-screen text-slate-100 bg-slate-950 bg-[radial-gradient(circle_at_top,_rgba(45,212,191,0.23),_transparent_52%),radial-gradient(circle_at_bottom,_rgba(37,99,235,0.22),_transparent_55%)]">

<div class="max-w-4xl mx-auto px-4 py-12">
  <!-- RESULTS HEADER -->
  <div class="text-center mb-12">
    <div class="w-24 h-24 bg-gradient-to-r from-emerald-500 to-emerald-600 rounded-3xl flex items-center justify-center mx-auto mb-6 shadow-2xl">
      <span class="text-3xl">üèÜ</span>
    </div>
    <h1 class="text-4xl md:text-5xl font-bold bg-gradient-to-r from-emerald-400 to-blue-400 bg-clip-text text-transparent mb-4">
      Your Results
    </h1>
    <p class="text-xl text-slate-400 mb-2">PAID-9 Contest</p>
    <p class="text-2xl font-bold text-emerald-400" id="totalScore">Calculating...</p>
  </div>

  <!-- USER INFO -->
  <div class="bg-slate-900/80 border border-slate-800 rounded-3xl p-8 mb-8">
    <div class="grid md:grid-cols-3 gap-6 text-sm">
      <div>
        <p class="text-slate-500 uppercase tracking-wide text-xs mb-1">Contest</p>
        <p class="font-semibold text-emerald-400">PAID-9</p>
      </div>
      <div>
        <p class="text-slate-500 uppercase tracking-wide text-xs mb-1">Total Marks</p>
        <p class="font-semibold" id="totalMarks">100</p>
      </div>
      <div>
        <p class="text-slate-500 uppercase tracking-wide text-xs mb-1">Completed</p>
        <p class="font-semibold text-emerald-400" id="completedAt">Just now</p>
      </div>
    </div>
  </div>

  <!-- QUESTIONS TABLE -->
  <div class="bg-slate-900/80 border border-slate-800 rounded-3xl p-6 mb-8">
    <h2 class="text-2xl font-bold mb-6 flex items-center gap-3">
      <span>üìä Question-wise Performance</span>
    </h2>
    <div class="overflow-x-auto">
      <table class="w-full text-sm">
        <thead>
          <tr class="border-b border-slate-700">
            <th class="text-left py-4 pr-4 font-semibold">Question</th>
            <th class="text-left py-4 px-4 font-semibold">Type</th>
            <th class="text-left py-4 px-4 font-semibold">Marks</th>
            <th class="text-left py-4 px-4 font-semibold">Status</th>
            <th class="text-left py-4 pl-4 font-semibold">Score</th>
          </tr>
        </thead>
        <tbody id="resultsTableBody">
          <!-- Results will load here -->
        </tbody>
      </table>
    </div>
  </div>

  <!-- ACTION BUTTONS -->
  <div class="flex flex-col sm:flex-row gap-4 justify-center">
    <a href="index.html" class="px-8 py-4 bg-gradient-to-r from-slate-700 to-slate-800 hover:from-slate-600 hover:to-slate-700 text-white font-semibold rounded-2xl text-center transition-all shadow-xl">
      ‚Üê Back to Home
    </a>
    <a href="leaderboard.html" class="px-8 py-4 bg-gradient-to-r from-emerald-500 to-emerald-600 hover:from-emerald-600 hover:to-emerald-700 text-white font-semibold rounded-2xl text-center transition-all shadow-xl">
      üèÜ View Leaderboard
    </a>
  </div>
</div>

<script>
  // Get contest from URL
  const urlParams = new URLSearchParams(window.location.search);
  const contestId = urlParams.get('contestId') || 'paid-9';
  
  // Mock questions data (same as exam.html)
  const questions = [
    {"question": "What is 2+2?", "type": "mcq", "marks": 20},
    {"question": "Array length kaise nikale?", "type": "mcq", "marks": 20},
    {"question": "console.log ka output?", "type": "mcq", "marks": 20},
    {"question": "var vs let?", "type": "mcq", "marks": 20},
    {"question": "Coding Problem 1", "type": "coding", "marks": 20}
  ];

  // Get user submissions from localStorage
  function getUserSubmissions() {
    const userId = localStorage.getItem('user_id');
    const submissions = [];
    
    questions.forEach((q, i) => {
      const submission = localStorage.getItem(`paid9_submission_${i}`);
      if (submission) {
        try {
          submissions.push({
            ...q,
            ...JSON.parse(submission),
            index: i
          });
        } catch(e) {}
      } else {
        // No submission
        submissions.push({
          ...q,
          answered: false,
          score: 0,
          index: i
        });
      }
    });
    
    return submissions;
  }

  // Calculate score (simple logic - answered = full marks)
  function calculateScore(submissions) {
    let totalScore = 0;
    submissions.forEach(s => {
      s.score = s.answered ? s.marks : 0;
      totalScore += s.score;
    });
    return totalScore;
  }

  // Render results table
  function renderResults() {
    const submissions = getUserSubmissions();
    const totalScore = calculateScore(submissions);
    
    // Update header
    document.getElementById('totalScore').textContent = `${totalScore}/${submissions.reduce((sum, s) => sum + s.marks, 0)}`;
    document.getElementById('totalMarks').textContent = submissions.reduce((sum, s) => sum + s.marks, 0);
    document.getElementById('completedAt').textContent = new Date().toLocaleString('hi-IN');

    // Render table
    document.getElementById('resultsTableBody').innerHTML = submissions.map(s => `
      <tr class="border-b border-slate-800 hover:bg-slate-800/50 transition-colors">
        <td class="py-4 pr-4 font-medium">Q${s.index + 1}. ${s.question}</td>
        <td class="py-4 px-4">
          <span class="px-3 py-1 rounded-full text-xs bg-emerald-500/20 text-emerald-400 border border-emerald-500/30">
            ${s.type.toUpperCase()}
          </span>
        </td>
        <td class="py-4 px-4 font-semibold">${s.marks}</td>
        <td class="py-4 px-4">
          <span class="px-3 py-1 rounded-full text-xs ${
            s.answered ? 'bg-emerald-500/20 text-emerald-400 border border-emerald-500/30' : 
            'bg-red-500/20 text-red-400 border border-red-500/30'
          }">
            ${s.answered ? '‚úÖ Answered' : '‚ùå Skipped'}
          </span>
        </td>
        <td class="py-4 pl-4 font-bold text-lg ${
          s.score > 0 ? 'text-emerald-400' : 'text-slate-500'
        }">${s.score}</td>
      </tr>
    `).join('');
  }

  // Load on page ready
  document.addEventListener('DOMContentLoaded', () => {
    console.log('üöÄ Results page loaded for contest:', contestId);
    renderResults();
    
    // Clear exam data after showing results
    localStorage.removeItem('exam_completed_paid9');
    questions.forEach((_, i) => {
      localStorage.removeItem(`paid9_${i}`);
      localStorage.removeItem(`paid9_submission_${i}`);
    });
  });
</script>

</body>
</html>
