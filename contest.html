<!DOCTYPE html>
<html lang="hi">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title id="contest-title">Contest - CodeRush</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="contests-config.js"></script>
  <style>
    * { font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif; }
  </style>
  <!-- Supabase -->
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2.48.0/dist/umd/supabase.min.js"></script>
<script src="contests-config.js"></script>  <!-- ‚Üê ‡§Ø‡•á ‡§®‡§Ø‡§æ line -->

</head>

<body class="min-h-screen text-slate-100 bg-slate-950
             bg-[radial-gradient(circle_at_top,_rgba(45,212,191,0.23),_transparent_52%),radial-gradient(circle_at_bottom,_rgba(37,99,235,0.22),_transparent_55%)]">

<!-- Top Navbar -->
<header class="border-b border-slate-800/60 bg-slate-950/80 backdrop-blur sticky top-0 z-30">
  <nav class="max-w-4xl mx-auto flex items-center justify-between px-4 py-3">
    <a href="dashboard.html" class="flex items-center gap-2">
      <div class="h-8 w-8 rounded-xl bg-gradient-to-br from-emerald-400 to-cyan-500 flex items-center justify-center text-slate-900 font-extrabold">
        C
      </div>
      <span class="font-semibold text-lg tracking-tight">CodeRush</span>
    </a>
    <a href="dashboard.html" class="px-4 py-2 bg-emerald-500 hover:bg-emerald-600 text-slate-900 font-semibold rounded-xl text-sm">
      ‚Üê Back to Dashboard
    </a>
  </nav>
</header>

<main class="max-w-4xl mx-auto px-4 py-8 md:py-12">
  <div id="contest-details" class="bg-slate-900/75 border border-slate-800/60 rounded-3xl shadow-[0_0_40px_rgba(15,23,42,0.95)] p-8 md:p-12 mb-8">
    <!-- Contest details dynamically loaded here -->
  </div>

  <!-- Contest Leaderboard -->
  <section class="bg-slate-900/80 border border-slate-800 rounded-3xl p-8">
    <div class="flex items-center justify-between mb-6">
      <h2 class="text-2xl font-bold bg-gradient-to-r from-emerald-400 to-cyan-400 bg-clip-text text-transparent">
        Live Leaderboard
      </h2>
      <div class="text-sm text-slate-400">Real-time ranking</div>
    </div>
    <div id="contest-leaderboard" class="text-xs text-slate-200">
      <p class="text-slate-400 text-center py-12">Loading leaderboard...</p>
    </div>
  </section>

  <!-- Contest Problems (COMING SOON) -->
  <section class="mt-8 bg-slate-900/80 border border-slate-800 rounded-3xl p-8 text-center">
    <div class="text-6xl mb-4">üöß</div>
    <h3 class="text-2xl font-bold text-slate-300 mb-2">Contest Problems</h3>
    <p class="text-slate-400 mb-4">Problems will appear here when contest starts</p>
    <div class="grid md:grid-cols-3 gap-4 text-sm text-slate-500 mt-6">
      <div>Problem 1 (Easy)</div>
      <div>Problem 2 (Medium)</div>
      <div>Problem 3 (Hard)</div>
    </div>
  </section>
</main>

<!-- Supabase -->
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2.48.0/dist/umd/supabase.min.js"></script>
<script>
const SUPABASE_URL = 'https://tghtgygjawhrcgtwhrej.supabase.co';
const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InRnaHRneWdqYXdocmNndHdocmVqIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjU5OTM0MjksImV4cCI6MjA4MTU2OTQyOX0.Q-Ht_IFcPZPIHO5905o70EDya2yFdVP-9LjDmjkle38';
const supabaseClient = supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

const urlParams = new URLSearchParams(window.location.search);
const contestId = parseInt(urlParams.get('id'));

// Load contest details
function loadContestDetails() {
  if (!CONTESTS || !contestId) {
    document.getElementById('contest-details').innerHTML = '<p class="text-red-400 text-center py-12">Contest not found!</p>';
    return;
  }

  const contest = CONTESTS.find(c => c.id === contestId);
  if (!contest) {
    document.getElementById('contest-details').innerHTML = '<p class="text-red-400 text-center py-12">Contest not found!</p>';
    return;
  }

  document.title = `${contest.name} - CodeRush`;
  
  document.getElementById('contest-details').innerHTML = `
    <div class="text-center mb-8">
      <div class="inline-flex items-center gap-2 bg-${contest.color}-500/20 border-2 border-${contest.color}-500/40 px-6 py-3 rounded-2xl mb-6">
        <div class="w-3 h-3 bg-${contest.color}-400 rounded-full animate-pulse"></div>
        <span class="text-sm font-bold text-${contest.color}-400 uppercase tracking-wider">LIVE</span>
      </div>
      <h1 class="text-4xl md:text-5xl font-black bg-gradient-to-r from-${contest.color}-400 to-${contest.color}-200 bg-clip-text text-transparent mb-4">
        ${contest.name}
      </h1>
      <p class="text-xl text-slate-300 mb-8">${contest.description}</p>
    </div>
    
    <div class="grid md:grid-cols-3 gap-8 text-center">
      <div class="bg-slate-800/50 border border-slate-700 rounded-2xl p-6">
        <div class="text-3xl font-black text-emerald-400 mb-2">‚Çπ${contest.totalPrize.toLocaleString()}</div>
        <div class="text-slate-400 text-sm uppercase tracking-wide">Prize Pool</div>
      </div>
      <div class="bg-slate-800/50 border border-slate-700 rounded-2xl p-6">
        <div class="text-3xl font-bold text-${contest.color}-400 mb-2">${contest.fee === 0 ? 'FREE' : '‚Çπ' + contest.fee}</div>
        <div class="text-slate-400 text-sm uppercase tracking-wide">Entry Fee</div>
      </div>
      <div class="bg-slate-800/50 border border-slate-700 rounded-2xl p-6">
        <button id="join-btn" class="w-full bg-gradient-to-r from-${contest.color}-500 to-${contest.color}-400 hover:from-${contest.color}-600 hover:to-${contest.color}-500 text-slate-900 font-black py-4 px-8 rounded-2xl text-lg shadow-2xl transition-all duration-300 transform hover:-translate-y-1">
          ${contest.fee === 0 ? 'Join Test Free' : 'Pay ‚Çπ' + contest.fee + ' & Join'}
        </button>
      </div>
    </div>
  `;

  // Join button handler
  document.getElementById('join-btn').onclick = () => {
    if (contest.fee === 0) {
      alert('Free contest joined! Problems will load in 3 seconds...');
      // Start free contest logic
    } else {
      // Razorpay payment (NEXT STEP)
      alert(`Razorpay payment for ‚Çπ${contest.fee} will integrate here!`);
    }
  };
}

// Load leaderboard
async function loadContestLeaderboard() {
  const container = document.getElementById('contest-leaderboard');
  try {
    const { data: { user } } = await supabaseClient.auth.getUser();
    
    const { data, error } = await supabaseClient
      .from('leaderboard')
      .select('user_id, score, rank')
      .eq('contest_id', contestId)
      .order('score', { ascending: false });

    if (error || !data?.length) {
      container.innerHTML = `
        <div class="text-center py-12 text-slate-400">
          <div class="text-4xl mb-4">üèÜ</div>
          <p>No participants yet!</p>
          <p class="text-sm mt-2">Be the first to join and get #1 rank</p>
        </div>
      `;
      return;
    }

    const rows = data.map((row, index) => {
      const isYou = user && row.user_id === user.id;
      return `
        <tr class="border-t border-slate-800/50 ${isYou ? 'bg-emerald-500/10' : ''}">
          <td class="px-4 py-3 text-center font-bold text-lg ${isYou ? 'text-emerald-400' : 'text-slate-200'}">
            ${row.rank || index + 1}
          </td>
          <td class="px-4 py-3 font-semibold ${isYou ? 'text-emerald-400' : 'text-slate-100'}">
            ${isYou ? 'You' : row.user_id?.slice(0, 8) + '...'}
          </td>
          <td class="px-4 py-3 text-right font-bold text-slate-100">
            ${row.score || 0}
          </td>
        </tr>
      `;
    }).join('');

    container.innerHTML = `
      <div class="border border-slate-800 rounded-2xl overflow-hidden">
        <table class="w-full">
          <thead class="bg-slate-800/80">
            <tr>
              <th class="px-4 py-3 text-left text-slate-300 font-semibold">Rank</th>
              <th class="px-4 py-3 text-left text-slate-300 font-semibold">Contestant</th>
              <th class="px-4 py-3 text-left text-slate-300 font-semibold">Score</th>
            </tr>
          </thead>
          <tbody>${rows}</tbody>
        </table>
      </div>
    `;
  } catch (e) {
    container.innerHTML = '<p class="text-red-400 text-center py-12">Error loading leaderboard</p>';
  }
}

// Auth check + Load
(async () => {
  const { data, error } = await supabaseClient.auth.getUser();
  if (error || !data.user) {
    window.location.href = 'index.html';
    return;
  }
  
  loadContestDetails();
  loadContestLeaderboard();
  
  // Auto-refresh leaderboard every 10s
  setInterval(loadContestLeaderboard, 10000);
})();
</script>
</body>
</html>
