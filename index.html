<!DOCTYPE html>
<html lang="hi">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>CodeRush – Practice DSA, Contests & Interview Prep</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    * { font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif; }
    .glass { backdrop-filter: blur(20px); }
    .animate-pulse-custom { animation: pulse 2s cubic-bezier(0.4, 0, 0.6, 1) infinite; }
  </style>
</head>
<body class="bg-gradient-to-br from-slate-900 via-slate-900/90 to-slate-950 text-slate-100 min-h-screen">

<!-- Navbar -->
<header class="border-b border-slate-800/50 bg-slate-900/95 glass sticky top-0 z-50 shadow-2xl">
  <nav class="max-w-7xl mx-auto flex items-center justify-between px-4 py-4 lg:px-8">
    <div class="flex items-center gap-3">
      <div class="h-12 w-12 rounded-2xl bg-gradient-to-br from-emerald-400 via-emerald-500 to-cyan-500 flex items-center justify-center text-slate-900 font-black text-xl shadow-2xl">
        C
      </div>
      <div>
        <span class="font-black text-2xl tracking-tight bg-gradient-to-r from-emerald-400 to-cyan-400 bg-clip-text text-transparent">
          CodeRush
        </span>
        <p class="text-xs text-emerald-400 font-medium tracking-wide">Practice • Compete • Win</p>
      </div>
    </div>

    <div class="hidden lg:flex items-center gap-8 text-sm font-medium">
      <a href="#problems" class="hover:text-emerald-400 transition-colors group">
        Problems
        <span class="block h-0.5 bg-emerald-400 scale-x-0 group-hover:scale-x-100 transition-transform origin-left mt-1"></span>
      </a>
      <a href="#home-contests-section" class="hover:text-emerald-400 transition-colors group">
        Contests
        <span class="block h-0.5 bg-emerald-400 scale-x-0 group-hover:scale-x-100 transition-transform origin-left mt-1"></span>
      </a>
      <a href="#premium" class="hover:text-emerald-400 transition-colors group">
        Premium
        <span class="block h-0.5 bg-emerald-400 scale-x-0 group-hover:scale-x-100 transition-transform origin-left mt-1"></span>
      </a>
      <a href="contests.html" class="hover:text-emerald-400 transition-colors group">
        Live Contests
        <span class="block h-0.5 bg-emerald-400 scale-x-0 group-hover:scale-x-100 transition-transform origin-left mt-1"></span>
      </a>
    </div>

    <div class="flex items-center gap-3">
      <button id="open-login" class="text-sm px-6 py-2.5 rounded-xl border-2 border-slate-700/50 hover:border-emerald-400/70 hover:text-emerald-300 hover:bg-emerald-500/5 backdrop-blur-sm transition-all duration-300">
        Sign in
      </button>
      <button id="open-signup" class="text-sm px-8 py-2.5 rounded-xl bg-gradient-to-r from-emerald-500 to-emerald-400 hover:from-emerald-600 hover:to-emerald-500 text-slate-900 font-bold shadow-xl hover:shadow-emerald-500/25 transition-all duration-300 transform hover:-translate-y-0.5">
        Start Free
      </button>
    </div>
  </nav>
</header>

<!-- Hero + snapshot -->
<main class="max-w-7xl mx-auto px-4 py-20 lg:py-32">
  <!-- (hero + contests + features same as tumne bheja, unchanged) -->
  <!-- ... yaha se lekar </main> tak tumhara existing markup already sahi hai ... -->
  <!-- isliye chhoda ja raha hai, sirf scripts change kiye gaye hain -->
</main>

<!-- Auth Modal (unchanged markup) -->
<div id="auth-modal" class="fixed inset-0 bg-black/80 backdrop-blur-2xl flex items-center justify-center px-4 z-50 hidden animate-fade-in">
  <!-- modal content ... (jo tumne bheja hai, same rakhna) -->
</div>

<!-- Supabase -->
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2.48.0/dist/umd/supabase.min.js"></script>
<script src="contests-config.js"></script>

<script>
// render contest cards
function renderContestCards(containerId, contests) {
  const container = document.getElementById(containerId);
  if (!container || !Array.isArray(contests)) return;

  container.innerHTML = "";

  contests.forEach((c) => {
    const card = document.createElement("div");
    card.className =
      "rounded-2xl p-5 bg-gradient-to-r from-emerald-500 via-cyan-500 to-sky-500 " +
      "text-white flex flex-col justify-between shadow-xl";

    const btnLabel = c.entryFee === 0 ? "Register now" : "Join for ₹" + c.entryFee;

    card.innerHTML = `
      <div>
        <div class="text-xs uppercase tracking-wide opacity-90">
          ${c.cardTag || ""}
        </div>
        <h3 class="mt-1 text-xl font-semibold">
          ${c.cardTitle || c.title}
        </h3>
        <p class="mt-1 text-sm opacity-90">
          ${c.cardSubtitle || ""}
        </p>

        <div class="mt-4">
          <div class="text-[11px] uppercase opacity-80">Win prize</div>
          <div class="text-3xl font-bold leading-tight">
            ${c.cardPrizeText || `Win ₹${c.totalPrize}`}
          </div>
          <p class="mt-1 text-xs opacity-90">
            ${c.cardHighlight || ""}
          </p>
        </div>
      </div>

      <div class="mt-5 flex items-center justify-between">
        <div class="text-sm">
          Entry
          <span class="font-semibold">
            ${c.entryFee === 0 ? "Free" : "₹" + c.entryFee}
          </span>
        </div>
        <button
          class="px-4 py-2 rounded-full bg-white text-slate-900 text-sm font-semibold hover:bg-slate-100 transition"
          onclick="handleContestCTA('${c.type}', ${c.entryFee}, '${c.variant || ""}')"
        >
          ${btnLabel}
        </button>
      </div>
    `;

    container.appendChild(card);
  });
}
window.renderContestCards = renderContestCards;
</script>

<script>
const SUPABASE_URL = 'https://tghtgygjawhrcgtwhrej.supabase.co';
const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InRnaHRneWdqYXdocmNndHdocmVqIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjU5OTM0MjksImV4cCI6MjA4MTU2OTQyOX0.Q-Ht_IFcPZPIHO5905o70EDya2yFdVP-9LjDmjkle38';

const supabaseClient = supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

// redirect logged-in users to dashboard
async function checkAuth() {
  try {
    const { data } = await supabaseClient.auth.getUser();
    if (data?.user) {
      window.location.href = 'dashboard.html';
    }
  } catch (error) {
    console.error('Auth check failed:', error);
  }
}
checkAuth();

// contest CTA handler
function handleContestCTA(type, amount = 0, variant = '') {
  supabaseClient.auth.getUser().then(({ data }) => {
    const user = data?.user;
    if (!user) {
      window.targetContest = { type, amount, variant };
      openModal('signup');
      return;
    }

    let params;
    if (type === 'free') {
      params = 'type=free';
    } else {
      params = `type=paid&amount=${amount}${variant ? `&variant=${variant}` : ''}`;
    }
    window.location.href = `contest.html?${params}`;
  });
}
window.handleContestCTA = handleContestCTA;

// render featured contests
document.addEventListener("DOMContentLoaded", function () {
  if (window.getFeaturedContests) {
    const featured = window.getFeaturedContests();
    window.renderContestCards("home-contests", featured);
  }
});

// AUTH MODAL LOGIC
const modal = document.getElementById('auth-modal');
const authTitle = document.getElementById('auth-title');
const tabLogin = document.getElementById('tab-login');
const tabSignup = document.getElementById('tab-signup');
const form = document.getElementById('auth-form');
const emailInput = document.getElementById('auth-email');
const passInput = document.getElementById('auth-password');
const submitBtn = document.getElementById('submit-btn');
const submitText = document.getElementById('submit-text');
const loadingSpinner = document.getElementById('loading-spinner');
const switchText = document.getElementById('switch-text');
const switchAuth = document.getElementById('switch-auth');
const extraBox = document.getElementById('signup-extra');
const nameInput = document.getElementById('auth-name');
const phoneInput = document.getElementById('auth-phone');

let currentMode = 'login';

function setMode(mode) {
  currentMode = mode;
  
  if (mode === 'signup') {
    authTitle.textContent = 'Create your CodeRush Account';
    tabLogin.className = 'flex-1 py-3.5 bg-transparent text-slate-400 backdrop-blur-sm';
    tabSignup.className = 'flex-1 py-3.5 bg-slate-800/70 border-emerald-500 text-emerald-400 backdrop-blur-sm';
    switchText.textContent = 'Already have an account?';
    switchAuth.textContent = 'Sign in';
    submitText.textContent = 'Create Account';
    extraBox.classList.remove('hidden');
  } else {
    authTitle.textContent = 'Sign in to CodeRush';
    tabSignup.className = 'flex-1 py-3.5 bg-transparent text-slate-400 backdrop-blur-sm';
    tabLogin.className = 'flex-1 py-3.5 bg-slate-800/70 border-emerald-500 text-emerald-400 backdrop-blur-sm';
    switchText.textContent = "Don't have an account?";
    switchAuth.textContent = 'Sign up';
    submitText.textContent = 'Sign In';
    extraBox.classList.add('hidden');
  }
}

function openModal(mode = 'login') {
  setMode(mode);
  document.body.style.overflow = 'hidden';
  modal.classList.remove('hidden');
  emailInput.focus();
}

function closeModal() {
  document.body.style.overflow = '';
  modal.classList.add('hidden');
  form.reset();
  extraBox.classList.add('hidden');
}

document.getElementById('open-login').onclick = () => openModal('login');
document.getElementById('open-signup').onclick = () => openModal('signup');
document.getElementById('cta-start').onclick = () => openModal('signup');
document.getElementById('close-auth').onclick = closeModal;
document.getElementById('switch-auth').onclick = () => setMode(currentMode === 'login' ? 'signup' : 'login');
tabLogin.onclick = () => setMode('login');
tabSignup.onclick = () => setMode('signup');

document.addEventListener('keydown', (e) => {
  if (e.key === 'Escape' && !modal.classList.contains('hidden')) {
    closeModal();
  }
});

form.addEventListener('submit', async (e) => {
  e.preventDefault();
  
  const email = emailInput.value.trim();
  const password = passInput.value.trim();
  const fullName = nameInput ? nameInput.value.trim() : '';
  const phone = phoneInput ? phoneInput.value.trim() : '';
  
  if (!email || !password) {
    showError('Please fill all fields');
    return;
  }

  if (currentMode === 'signup' && (!fullName || !phone)) {
    showError('Please enter name and mobile number');
    return;
  }

  submitBtn.disabled = true;
  submitText.classList.add('hidden');
  loadingSpinner.classList.remove('hidden');

  try {
    let result;
    
    if (currentMode === 'signup') {
      result = await supabaseClient.auth.signUp({ 
        email, 
        password,
        options: {
          emailRedirectTo: window.location.origin + '/dashboard.html'
        }
      });

      if (result.error) {
        showError(result.error.message);
        return;
      }

      const user = result.data.user;
      if (user) {
        await supabaseClient
          .from('user_profiles')
          .upsert({
            id: user.id,
            full_name: fullName,
            phone: phone
          });
      }
    } else {
      result = await supabaseClient.auth.signInWithPassword({ email, password });
      if (result.error) {
        showError(result.error.message);
        return;
      }
    }

    setTimeout(() => {
      window.location.href = 'dashboard.html';
    }, 800);

  } catch (error) {
    showError('Network error. Please try again.');
    console.error('Auth error:', error);
  } finally {
    submitBtn.disabled = false;
    submitText.classList.remove('hidden');
    loadingSpinner.classList.add('hidden');
  }
});

function showError(message) {
  const toast = document.createElement('div');
  toast.className = 'fixed top-4 right-4 bg-red-500/90 text-white px-6 py-3 rounded-2xl text-sm font-semibold shadow-2xl backdrop-blur-sm z-50';
  toast.textContent = message;
  document.body.appendChild(toast);
  
  setTimeout(() => { toast.remove(); }, 4000);
}

// smooth scroll for anchor links
document.querySelectorAll('a[href^="#"]').forEach(anchor => {
  anchor.addEventListener('click', function (e) {
    e.preventDefault();
    const target = document.querySelector(this.getAttribute('href'));
    if (target) {
      target.scrollIntoView({ behavior: 'smooth', block: 'start' });
    }
  });
});
</script>

</body>
</html>
